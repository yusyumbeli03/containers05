# Лабораторная работа № 5 : Взаимодействие контейнеров

## Цель работы
Выполнив данную работу студент сможет управлять взаимодействием нескольких контейнеров.

## Задание
Создать php приложение на базе двух контейнеров: nginx, php-fpm.

## Подготовка
Для выполнения данной работы необходимо иметь установленный на компьютере [Docker](https://www.docker.com/).

Для выполнения работы необходимо иметь опыт выполнения лабораторной работы №3.

## Выполнение
Создайте репозиторий `containers05` и скопируйте его себе на компьютер.

В директории `containers05` создайте директорию `mounts/site`. В данную директорию перепишите сайт на php, созданный в рамках предмета по php.

Создайте файл `.gitignore` в корне проекта и добавьте в него строки:

```bash
# Ignore files and directories
mounts/site/*

```

Создайте в директории `containers05` файл `nginx/default.conf` со следующим содержимым:

```
server {
    listen 80;
    server_name _;
    root /var/www/html;
    index index.php;
    location / {
        try_files $uri $uri/ /index.php?$args;
    }
    location ~ \.php$ {
        fastcgi_pass backend:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}

```

## Запуск и тестирование
Создайте сеть `internal` для контейнеров.
```
docker network create internal
```
Создайте контейнер `backend` со следующими свойствами:

-   на базе образа `php:7.4-fpm`;
-   к контейнеру примонтирована директория `mounts/site` в `/var/www/html`;
-   работает в сети `internal`.
```
docker run -d --name backend --network internal -v ${PWD}/mounts/site:/var/www/html php:7.4-fpm
```
Создайте контейнер `frontend` со следующими свойствами:

-   на базе образа `nginx:1.23-alpine`;
-   с примонтированной директорией `mounts/site` в `/var/www/html`;
-   с примонтированным файлом `nginx/default.conf` в `/etc/nginx/conf.d/default.conf`;
-   порт 80 контейнера проброшен на порт 80 хоста;
-   работает в сети `internal`.
```
docker run -d --name frontend --network internal -v ${PWD}/mounts/site:/var/www/html -v ${PWD}/nginx/default.conf:/etc/nginx/conf.d/default.conf -p 80:80 nginx:1.23-alpine
```
Проверьте работу сайта в браузере, перейдя по адресу `http://localhost`. Если отображается базовая страница `nginx`, то перегрузите страницу.

### Screenshot 

![screen](screen.jpg)

## Выводы
В данной лабораторной работе было создано PHP-приложение на основе двух контейнеров: `nginx` и `php-fpm`, с использованием Docker. Для этого были созданы две директории: `mounts/site` для размещения PHP-сайта и `nginx` для конфигурационного файла `nginx`. Затем были настроены и запущены контейнеры: `backend` на основе образа `php:7.4-fpm` и `frontend` на основе образа `nginx:1.23-alpine`. Контейнеры были объединены в сеть `internal` для взаимодействия. После успешного запуска была проверена работоспособность сайта, который теперь отображается в браузере по адресу `http://localhost`, предоставляя возможность управлять взаимодействием нескольких контейнеров в рамках одного приложения.

## Вопросы
1. Каким образом в данном примере контейнеры могут взаимодействовать друг с другом?
>Контейнеры в данном примере могут взаимодействовать друг с другом благодаря сети `internal`, которая была создана специально для этой цели. 
2. Как видят контейнеры друг друга в рамках сети `internal`?
>В рамках сети `internal` контейнеры видят друг друга как хосты с уникальными именами. Это означает, что они могут обращаться друг к другу по именам контейнеров, указанным при их создании, без необходимости знать IP-адреса друг друга.
3. Почему необходимо было переопределять конфигурацию `nginx`?
>Для того, чтобы настроить сервер `nginx` на обслуживание PHP-сайта. Базовый образ `nginx:1.23-alpine` по умолчанию не настроен для работы с PHP, поэтому был создан пользовательский конфигурационный файл `default.conf`, который указывает `nginx` перенаправлять запросы на обработку PHP к контейнеру `php-fpm (backend)`, где будет выполнен соответствующий скрипт. Это позволяет корректно обрабатывать запросы к PHP-скриптам и отдавать соответствующие ответы.